import{R as De,y as be,z as Ce,B as Ie,C as Oe,r as d,D as Ae,E as s,G as me,H as we,U as ie,I as ue,J as m,K as Le,M as z,N as _e,O as oe,Q as ke,T as le,V as pe}from"./index-CUEkJtnQ.js";const ce=De.use||(r=>{if(r.status==="pending")throw r;if(r.status==="fulfilled")return r.value;throw r.status==="rejected"?r.reason:(r.status="pending",r.then(R=>{r.status="fulfilled",r.value=R},R=>{r.status="rejected",r.reason=R}),r)}),G={dedupe:!0},Ne=(r,R,c)=>{const{cache:E,compare:M,suspense:y,fallbackData:B,revalidateOnMount:w,revalidateIfStale:L,refreshInterval:_,refreshWhenHidden:J,refreshWhenOffline:K,keepPreviousData:fe}=c,[k,de,v,Re]=Ie.get(E),[e,Q]=Oe(r),U=d.useRef(!1),I=d.useRef(!1),p=d.useRef(e),q=d.useRef(R),x=d.useRef(c),i=()=>x.current,P=()=>i().isVisible()&&i().isOnline(),[T,W,Ee,he]=Ae(E,e),O=d.useRef({}).current,ge=s(B)?c.fallback[e]:B,Y=(t,a)=>{for(const o in O){const n=o;if(n==="data"){if(!M(t[n],a[n])&&(!s(t[n])||!M(F,a[n])))return!1}else if(a[n]!==t[n])return!1}return!0},X=d.useMemo(()=>{const t=!e||!R?!1:s(w)?i().isPaused()||y?!1:s(L)?!0:L:w,a=l=>{const g=pe(l);return delete g._k,t?{isValidating:!0,isLoading:!0,...g}:g},o=T(),n=he(),h=a(o),C=o===n?h:a(n);let u=h;return[()=>{const l=a(T());return Y(l,u)?(u.data=l.data,u.isLoading=l.isLoading,u.isValidating=l.isValidating,u.error=l.error,u):(u=l,l)},()=>C]},[E,e]),V=me.useSyncExternalStore(d.useCallback(t=>Ee(e,(a,o)=>{Y(o,a)||t()}),[E,e]),X[0],X[1]),Z=!U.current,Se=k[e]&&k[e].length>0,D=V.data,b=s(D)?ge:D,N=V.error,$=d.useRef(b),F=fe?s(D)?$.current:D:b,ee=Se&&!s(N)?!1:Z&&!s(w)?w:i().isPaused()?!1:y?s(b)?!1:L:s(b)||L,te=!!(e&&R&&Z&&ee),ve=s(V.isValidating)?te:V.isValidating,Te=s(V.isLoading)?te:V.isLoading,A=d.useCallback(async t=>{const a=q.current;if(!e||!a||I.current||i().isPaused())return!1;let o,n,h=!0;const C=t||{},u=!v[e]||!C.dedupe,l=()=>le?!I.current&&e===p.current&&U.current:e===p.current,g={isValidating:!1,isLoading:!1},ne=()=>{W(g)},se=()=>{const f=v[e];f&&f[1]===n&&delete v[e]},re={isValidating:!0};s(T().data)&&(re.isLoading=!0);try{if(u&&(W(re),c.loadingTimeout&&s(T().data)&&setTimeout(()=>{h&&l()&&i().onLoadingSlow(e,c)},c.loadingTimeout),v[e]=[a(Q),we()]),[o,n]=v[e],o=await o,u&&setTimeout(se,c.dedupingInterval),!v[e]||v[e][1]!==n)return u&&l()&&i().onDiscarded(e),!1;g.error=ie;const f=de[e];if(!s(f)&&(n<=f[0]||n<=f[1]||f[1]===0))return ne(),u&&l()&&i().onDiscarded(e),!1;const S=T().data;g.data=M(S,o)?S:o,u&&l()&&i().onSuccess(o,e,c)}catch(f){se();const S=i(),{shouldRetryOnError:H}=S;S.isPaused()||(g.error=f,u&&l()&&(S.onError(f,e,S),(H===!0||ue(H)&&H(f))&&(!i().revalidateOnFocus||!i().revalidateOnReconnect||P())&&S.onErrorRetry(f,e,S,Ve=>{const j=k[e];j&&j[0]&&j[0](m.ERROR_REVALIDATE_EVENT,Ve)},{retryCount:(C.retryCount||0)+1,dedupe:!0})))}return h=!1,ne(),!0},[e,E]),ae=d.useCallback((...t)=>Le(E,p.current,...t),[]);if(z(()=>{q.current=R,x.current=c,s(D)||($.current=D)}),z(()=>{if(!e)return;const t=A.bind(ie,G);let a=0;const n=_e(e,k,(h,C={})=>{if(h==m.FOCUS_EVENT){const u=Date.now();i().revalidateOnFocus&&u>a&&P()&&(a=u+i().focusThrottleInterval,t())}else if(h==m.RECONNECT_EVENT)i().revalidateOnReconnect&&P()&&t();else{if(h==m.MUTATE_EVENT)return A();if(h==m.ERROR_REVALIDATE_EVENT)return A(C)}});return I.current=!1,p.current=e,U.current=!0,W({_k:Q}),ee&&(s(b)||oe?t():ke(t)),()=>{I.current=!0,n()}},[e]),z(()=>{let t;function a(){const n=ue(_)?_(T().data):_;n&&t!==-1&&(t=setTimeout(o,n))}function o(){!T().error&&(J||i().isVisible())&&(K||i().isOnline())?A(G).then(a):a()}return a(),()=>{t&&(clearTimeout(t),t=-1)}},[_,J,K,e]),d.useDebugValue(F),y&&s(b)&&e){if(!le&&oe)throw new Error("Fallback data is required when using suspense in SSR.");q.current=R,x.current=c,I.current=!1;const t=Re[e];if(!s(t)){const a=ae(t);ce(a)}if(s(N)){const a=A(G);s(F)||(a.status="fulfilled",a.value=!0),ce(a)}else throw N}return{mutate:ae,get data(){return O.data=!0,F},get error(){return O.error=!0,N},get isValidating(){return O.isValidating=!0,ve},get isLoading(){return O.isLoading=!0,Te}}},Fe=Ce(Ne),Me=r=>(R,c,E)=>(E.revalidateOnFocus=!1,E.revalidateIfStale=!1,E.revalidateOnReconnect=!1,r(R,c,E)),Ue=be(Fe,Me);export{Ue as u};
